schema pilot.gate.phoenix.cyboquatic.v1 {
  header {
    ecosafety_hex: "0xC1B0QUA7IC-PHX-ALN-2026-01-17";
    author_did_primary: "bostrom18sd2ujv24ual9c9pshtxys6j8knh6xaead9ye7";
    author_did_alt: "bostrom1ldgmtf20d6604a24ztr0jxht7xt7az4jhkmsrc";
    linked_qpudatashard: "qpudatashards.cyboquatic-phoenix.aln";
    region: "Phoenix-AZ-US";
  }

  particle pilot.metrics {
    q_design_m3s: f64;        // design flow
    t_res_s: f64;             // residence time
    v_reactor_m3: f64;        // reactor volume
    sewer_surcharge_events: u32;
    backflow_incidents: u32;
    bod_mgL: f64;
    tss_mgL: f64;
    n_total_mgL: f64;
    p_total_mgL: f64;
    cec_index: f64;           // normalized 0–1
    pfbs_index: f64;          // CEIM-style 0–1
    sat_hlr_mday: f64;
    sat_clogging_index: f64;  // 0–1
    fouling_rate_rel: f64;    // 1/J dJ/dt
    om_cost_rel: f64;         // vs design baseline
    social_trust_score: f64;  // 0–1
    dashboard_uptime: f64;    // 0–1
    violation_residual: f64;  // V(t)
  }

  corridor pilot.corridor {
    // Example corridor bounds; exact values tuned in Rust config.
    bod_mgL_max: f64;
    tss_mgL_max: f64;
    n_total_mgL_max: f64;
    p_total_mgL_max: f64;
    cec_index_max: f64;
    pfbs_index_max: f64;
    sat_hlr_mday_min: f64;
    sat_hlr_mday_max: f64;
    fouling_rate_rel_min: f64;
    fouling_rate_rel_max: f64;
    social_trust_min: f64;
    violation_residual_max: f64;
  }

  contract gate.hydraulic_structural(pilot.metrics m) -> bool {
    return
      m.sewer_surcharge_events == 0 &&
      m.backflow_incidents == 0 &&
      m.violation_residual <= violation_residual_max;
  }

  contract gate.treatment_sat(pilot.metrics m) -> bool {
    return
      m.bod_mgL      <= bod_mgL_max &&
      m.tss_mgL      <= tss_mgL_max &&
      m.n_total_mgL  <= n_total_mgL_max &&
      m.p_total_mgL  <= p_total_mgL_max &&
      m.cec_index    <= cec_index_max &&
      m.pfbs_index   <= pfbs_index_max &&
      m.sat_hlr_mday >= sat_hlr_mday_min &&
      m.sat_hlr_mday <= sat_hlr_mday_max;
  }

  contract gate.fouling_om(pilot.metrics m) -> bool {
    return
      m.fouling_rate_rel >= fouling_rate_rel_min &&
      m.fouling_rate_rel <= fouling_rate_rel_max &&
      m.om_cost_rel <= 1.0 &&
      m.violation_residual <= violation_residual_max;
  }

  contract gate.social_governance(pilot.metrics m) -> bool {
    return
      m.social_trust_score >= social_trust_min &&
      m.dashboard_uptime   >= 0.97 &&
      m.violation_residual <= violation_residual_max;
  }

  contract gate.pilot_scale_up(pilot.metrics m) -> bool {
    return
      gate.hydraulic_structural(m) &&
      gate.treatment_sat(m) &&
      gate.fouling_om(m) &&
      gate.social_governance(m);
  }
}
